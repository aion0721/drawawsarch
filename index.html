<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>01 Draggable | jQuery UI / Drag and Drop</title>
  <script src="./js/html2canvas.js"></script>
  <link rel="stylesheet" href="./css/jquery-ui.css">
</head>
<body>
<style>
  body {
    margin: 20px;
  }
  .item {
    padding: 10px;
    width: 80px;
    height: 80px;
    background-color: #2e6da4;
    color: #FFFFFF;
  }
  .item:hover {
    cursor: pointer;
  }
  .icon{
      height:100px;
      width:100px;
  }
  #area{
      height: 500px;
      width: 500px;
      border: solid;
  }
</style>

<div id="container">
  <div class="item">
    <p>ドラッグしてください</p>
  </div>
</div>

<script src="./js/jquery.js"></script>
<script src="./js/jquery-ui.js"></script>
<script>

    function getRandStr(){
        var len = 8;
var str = "abcdefghijklmnopqrstuvwxyz";
var strLen = str.length;
var result = "";
 
for (var i = 0; i < len; i++) {
  result += str[Math.floor(Math.random() * strLen)];
}
 
return result;
    }
  $(function() {
    $('.item').draggable();
    $('#download-btn').on('click', function(){
      html2canvas(document.querySelector("#area")).then(canvas => { 
      let downloadEle = document.createElement("a");
      downloadEle.href = canvas.toDataURL("image/png");
      downloadEle.download = "canvas.png";
      downloadEle.click();
    });
  })
  $("#area").resizable();
    $('.appendImg').on('click', function(){

        var tmpStr = getRandStr();
        var ImgId = $(this).attr('id');

        var parentId= "img-window-" + tmpStr
        var childId = "img-" + tmpStr

        var parentdiv = $('<div id="' + parentId + '"></div>').appendTo("#area")
        var childimg = $('<img id="' + childId + '" src="./img/' + ImgId  +'.png" alt="' + ImgId +'" class="icon"></img>').appendTo("#" + parentId)

        $('#' + parentId).draggable({
            create: function() {
            // 生成されたときにdivのサイズとimgのサイズを合わせる
            var $win = $('#' + parentId);
            var $img  = $('#' + childId);
            $win.css({
                width : $img.css('width'),
                height: $img.css('height')
            });
        }

        }).resizable({
            handles: 'se,ne,sw,nw',
            aspectRatio: true,
            alsoResize: $('#' + childId)
        })

        $("#" + parentId).dblclick(function(){
            $("#" + parentId).remove();
        })

    })

    $("#outputData").on("click", function(){
        const areaData= [];

        $('#area .ui-draggable').each(function(i){
            var id = $(this).attr('id');
            var parentId = $(this).attr('id').replace("-window","")
            var width = $(this).css('width');
            var height = $(this).css('height');
            var left = $(this).css('left');
            var top = $(this).css('top');
            var alt = $('#' + parentId).attr('alt');
            console.log(id)
            areaData.push({ id: id, parendId: parentId, width: width, height: height, left: left, top: top, alt: alt})
        });

        $('#areaOutputData').val(JSON.stringify(areaData));
    })
  });
</script> 
<input id="download-btn" type="button" value="download image">
<input id="outputData" type="button" value="output">
<button class="appendImg" id="ec2">EC2</button>
<button class="appendImg" id="Aurora">Aurora</button>
<div id="area"class="ui-widget-content">
</div>
<h1>OUTPUTDATA</h1><br>
<textarea id="areaOutputData"></textarea><br>
<br>
<h1>INPUTDATA</h1><br>
<textarea id="areaInputData"></textarea><br>

</body>
</html>